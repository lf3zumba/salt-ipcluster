{% set username = pillar.get('ipcluster.username', 'ipuser') %}
{% set home = pillar.get('ipcluster.userhome', '/home/ipuser') %}
{% set host_cpus = salt['ps.num_cpus']() %}

[program:ipcontroller]
command=ipcontroller
user={{ username }}
directory={{ pillar.get('ipcluster.engine.directory', home) }}
environment=HOME='{{ home }}',USER={{ username }}
priority=100

[program:ipengine]
command=ipengine
user={{ username }}
numprocs={{ host_cpus - 1 }}
process_name=ipengine-%(process_num)s
directory={{ pillar.get('ipcluster.engine.directory', home) }}
environment=HOME='{{ home }}',USER={{ username }}
priority=110
